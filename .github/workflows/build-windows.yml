name: Windows Build

on:
  push:
    branches: [main, develop]

env:
  VCPKG_BINARY_SOURCES: "clear;x-gha,readwrite"

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: checkout repository
      uses: actions/checkout@v4
        
    - name: setup vcpkg
      uses: lukka/run-vcpkg@v11        
      with:
        vcpkgGitCommitId: 'be017f1'
        runVcpkgInstall: true

    - name: Check dependencies
      run: |
        .\vcpkg\vcpkg list

    - name: Run cmake
      uses: lukka/run-cmake@v10
      with:
        configurePreset: 'ninja-multi-vcpkg'
        buildPreset: 'ninja-multi-vcpkg'
        buildPresetAdditionalArgs: "['--config Release']"

    - name: Install Vulkan SDK
      run: |
        $ProgressPreference = 'SilentlyContinue'
        Invoke-WebRequest -Uri "https://sdk.lunarg.com/sdk/download/latest/windows/vulkan-sdk.exe" -OutFile VulkanSDK.exe
        .\VulkanSDK.exe --accept-licenses --default-answer --confirm-command install
